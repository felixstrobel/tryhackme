20.08.2020 | Felix Strobel ([relevant](https://tryhackme.com/p/relevant))

# Basic Pentesting

- [Task 1](#task-1)

## Task 1

<i>First we have to [connect](https://tryhackme.com/access) to the tryhackme network and deploy the machine. This is also our first question.</i>

1. Deploy the machine and connect to our network.<br>
   `No answer needed.`

<i>Then we should check which services are exposed by the machine. Let's first make a [nmap](https://nmap.org) scan. We want to use the default scripts `-sC` and we also want to detect versions `-sV` if possible.<br>
Our final command now looks like this: `nmap -sC -sV MACHINE_IP`<br>
After a little bit of waiting it gives us the following output. Here we can see that SSH is a thing and a HTTP service is running.</i>

<pre>
PORT     STATE SERVICE     VERSION
<b>22/tcp   open  ssh         OpenSSH 7.2p2</b> Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|_  256 a5:68:2b:22:5f:98:4a:62:21:3d:a2:e2:c5:a9:f7:c2 (ED25519)
<b>80/tcp   open  http        Apache</b> httpd 2.4.18 ((Ubuntu))
|_http-server-header: Apache/2.4.18 (Ubuntu)
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
8009/tcp open  ajp13?
8080/tcp open  http-proxy?
Service Info: Host: BASIC2; OS: Linux; CPE: cpe:/o:linux:linux_kernel
</pre>

2. Find the services exposed by the machine.<br>
   `No answer needed.`

<i>The next question prompts us to enter a hidden directory on the web server. So let's start [gobuster](https://github.com/OJ/gobuster) and search for a directory `dir`. The target will be specified with the `-u` flag. Don't forget the protocol! To select a wordlist you can use the `-w` flag. I am using the [`common.txt`](https://gitlab.com/kalilinux/packages/dirb/-/blob/kali/master/wordlists/common.txt) wordlist from [DIRB](http://dirb.sourceforge.net).<br>
Here is the final command: `gobuster dir -u http://MACHINE_IP -w ./common.txt`<br>
Just a few seconds later gobuster gives us the following output. All the founded directories are normal excepting the `development` directory.</i>

<pre>
/.hta (Status: 403)
/.htaccess (Status: 403)
/.htpasswd (Status: 403)
<b>/development</b> (Status: 301)
/index.html (Status: 200)
/server-status (Status: 403)
</pre>

3. What is the name of the hidden directory on the web server (enter name without /)?<br>
   `development`

<i>The next question gives us a hint what we have to do next. When visiting the `/development` directory we can see two text files. The `j.txt` file has some interesting content. It seems that j's password is not that strong. We will keep that in mind.</i>

4. User brute-forcing to find the username & password.<br>
   `No answer needed.`

<i>To brute-force j's password it is easier for us to know his full username. To get it we can enumerate the [Samba](https://www.samba.org) service. I decided to go with [enum4linux](https://labs.portcullis.co.uk/tools/enum4linux). With using the `-a` flag it is possible for us to do a simple enumeration on the machine.<br>
The final command looks like this: `enum4linux -a MACHINE_IP`<br>
This time it takes a little bit longer but the result clearly shows the two users on the machine.</i>

<pre>
S-1-22-1-1000 Unix User\<b>kay</b> (Local User)
S-1-22-1-1001 Unix User\<b>jan</b> (Local User)
</pre>

5. What is the username?<br>
   `jan`

<i>Now we know the full username and can start brute-forcing the password. My weapon of choice is [hydra](https://github.com/vanhauser-thc/thc-hydra). The `-l` flag let's us set the username we already found out. And to specify a wordlist, I will use the [`rockyou.txt`](https://gitlab.com/kalilinux/packages/wordlists/-/blob/kali/master/rockyou.txt.gz), we can use `-P`.<br>
The command: `hydra -l jan -P ./rockyou.txt ssh://MACHINE_IP`<br>
This operation is taking some minutes. Be pacient. When hydra finishes you will see the brute-forced password.</i>

<pre>
[22][ssh] host: 10.10.155.245   login: jan   password: <b>armando</b>
</pre>

6. What is the password?<br>
   `armando`

<i>The next question is easy to answer. We already found all of the credentials for a successful ssh login. So why don't use ssh to get into the machine.</i>

7. What service do you use to access the server?<br>
   `SSH`

<i>Now we are told to enumerate the machine and check if there is any option to escalate our priviledges.</i><!--Describe how-->

8. Enumerate the machine to find any vectors for privilege escalation.<br>
   `No answer needed.`

<i>This question asks us for the second user on the machine. We found the second user before and can easily answer the question.</i>

9. What is the name of the other user you found?<br>
   `kay`

<i>Now there is the possibility that the other user can have more priviledges than our current user. The question leads us again to a ssh login. After a bit of searching I found kay's public and private keys in the `/home/kay/.ssh` directory. We can `cat` them out and save them on our machine. To hash the keys we run [`ssh2john.py`](https://www.openwall.com/john) and `echo` the result into `hashed_ssh_key.txt`.<br>
The command: `python ./john/ssh2john.py ssh_key.txt > hashed_ssh_key.txt`<br>
At this point we can use [`john`](https://www.openwall.com/john) to crack the password for kay. With the `--wordlist` flag we specify the wordlist `rockyou.txt`, already used before.<br>
The command should look like this: `john --wordlist=./rockyou.txt hashed_ssh_key.txt`<br>
This command will give you the cracked password for kay's user account. We are still logged in as jay but we want to change the user to kay. To do that we can simlply try to connect to kay's ssh with this command: `ssh /home/kay/.ssh/id_rsa kay@MACHINE_IP`<br>
And here we go. We have logged into kay's account. Now we have all the needed permissions to read the `pass.bak` file. Let's `cat` that out and see the password.
</i>

10. If you have found another user, what can you do with this information?<br>
    `No answer needed.`

<i>And we also found the password and can answer the final question.</i>

11. What is the final password you obtain?<br>
    `heresareallystrongpasswordthatfollowsthepasswordpolicy$$`

<i>It's good practise to try getting root on the machine. I looked what `sudo -l` gives me back and recognized that we can run all commands. I simply tried to switch the user `sudo su` and I was successful. I got root! And after checking the `/root` directory I found a little note from the author.</i>
